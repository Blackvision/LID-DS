import sys
import time
import random
import argparse
import requests

def http_requests():
    """
    main loop for normal behaviour
    """
    while True:
        try:
            sys.stdin.readline()
            random_choice = random.randint(1, 100)

            if in_range(random_choice, post_probability):
                print("upload")
                upload_file()
            elif in_range(random_choice, get_probability):
                print("download")
                download_file()

        except Exception:
            print("Error posting or getting")
            time.sleep(5)

def upload_file():
    """
    execute POST request to victim
    upload random file of list upload_file
    """
    upload_files = ["file1.txt",
                    "file2.txt",
                    "file3.txt",
                    "file4.txt",
                    "file5.txt",
                    "file6.txt"]
    file_choice = random.randint(0,5)
    print(f"Chose file {file_choice}")


def download_file():
    url = args.server_ip
    r = requests.get(args.server_ip, allow_redirects=True)
    print(r)


if __name__ == '__main__':
    parser = argparse.ArgumentParser(description='HTTPS-Client Simulation.')

    parser.add_argument('-ip', dest='server_ip', action='store', type=str, required=True,
                        help='The IP address of the target server')
    args = parser.parse_args()

    # appending tomcat port 
    args.server_ip = args.server_ip + ':8080'

    # probabilities
    post_probability = [1, 50]
    get_probability = [51, 100]

    http_requests()

